<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reels</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        body { margin: 0; background: #000; font-family: sans-serif; color: white; height: 100vh; display: flex; justify-content: center; }
        
        .reels-app { width: 100%; max-width: 450px; height: 100%; position: relative; background: #000; }
        
        /* Header */
        .header { position: absolute; top: 20px; width: 100%; padding: 0 20px; z-index: 10; display: flex; justify-content: space-between; box-sizing: border-box; }
        .icon { font-size: 28px; color: white; cursor: pointer; text-shadow: 0 2px 4px rgba(0,0,0,0.5); background: none; border: none; }

        /* Scroll Feed */
        .feed { height: 100%; overflow-y: scroll; scroll-snap-type: y mandatory; scrollbar-width: none; }
        .feed::-webkit-scrollbar { display: none; }

        .reel { width: 100%; height: 100%; scroll-snap-align: start; position: relative; background: #111; }
        video { width: 100%; height: 100%; object-fit: cover; }

        /* Overlay */
        .overlay { position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px 20px 40px 20px; background: linear-gradient(transparent, rgba(0,0,0,0.9)); box-sizing: border-box; pointer-events: none; }
        .info { pointer-events: auto; }
        .user { font-weight: bold; font-size: 16px; margin-bottom: 5px; display: block; }
        .caption { font-size: 14px; opacity: 0.9; }

        /* Right Actions */
        .actions { position: absolute; right: 10px; bottom: 100px; display: flex; flex-direction: column; gap: 25px; align-items: center; z-index: 5; pointer-events: auto; }
        .act-btn { background: none; border: none; color: white; display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .act-btn i { font-size: 32px; text-shadow: 0 2px 5px rgba(0,0,0,0.5); transition: 0.2s; }
        .act-btn span { font-size: 12px; margin-top: 5px; font-weight: 600; }
        .act-btn:active i { transform: scale(0.8); }

        /* Hidden Upload */
        input[type="file"] { display: none; }
    </style>
</head>
<body>
    <div class="reels-app">
        <div class="header">
            <button class="icon" onclick="window.location.href='/'"><i class='bx bx-arrow-back'></i></button>
            <button class="icon" onclick="document.getElementById('vid-in').click()"><i class='bx bx-camera'></i></button>
        </div>
        <input type="file" id="vid-in" accept="video/*" onchange="uploadReel(this)">

        <div class="feed" id="feed"></div>
    </div>

    <script>
        window.onload = function() {
            fetch('/api/reels_scroll').then(r=>r.json()).then(reels => {
                const feed = document.getElementById('feed');
                if(reels.length===0) feed.innerHTML = '<div style="height:100%; display:flex; justify-content:center; align-items:center;">No Reels Yet ðŸŽ¬</div>';
                
                reels.forEach(r => {
                    const html = `
                        <div class="reel">
                            <video src="/images/uploads/${r.filename}" loop onclick="this.paused?this.play():this.pause()"></video>
                            <div class="overlay">
                                <div class="info">
                                    <span class="user">@${r.username}</span>
                                    <span class="caption">${r.caption}</span>
                                </div>
                            </div>
                            <div class="actions">
                                <button class="act-btn" onclick="doAct('like', ${r.id})">
                                    <i class='bx bxs-heart'></i> <span>${r.likes}</span>
                                </button>
                                <button class="act-btn" onclick="alert('Comments comming soon!')">
                                    <i class='bx bxs-message-rounded-dots'></i> <span>0</span>
                                </button>
                            </div>
                        </div>`;
                    feed.insertAdjacentHTML('beforeend', html);
                });
            });
        }

        function doAct(act, id) {
            fetch('/api/action', {
                method:'POST', headers:{'Content-Type':'application/json'},
                body: JSON.stringify({action: act, id: id, type: 'video'})
            }).then(r=>r.json()).then(d=>{ if(d.success) location.reload(); });
        }

        function uploadReel(input) {
            const fd = new FormData(); fd.append('video', input.files[0]);
            alert("Uploading Reel... Please wait.");
            fetch('/api/upload', {method:'POST', body:fd}).then(r=>r.json()).then(d=>{ if(d.success) location.reload(); });
        }
    </script>
</body>
</html>